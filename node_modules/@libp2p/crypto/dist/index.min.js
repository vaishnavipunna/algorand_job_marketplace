(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PCrypto = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PCrypto=(()=>{var zr=Object.defineProperty;var $i=Object.getOwnPropertyDescriptor;var Xi=Object.getOwnPropertyNames;var Wi=Object.prototype.hasOwnProperty;var st=(e,t)=>{for(var r in t)zr(e,r,{get:t[r],enumerable:!0})},Ji=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Xi(t))!Wi.call(e,o)&&o!==r&&zr(e,o,{get:()=>t[o],enumerable:!(n=$i(t,o))||n.enumerable});return e};var Qi=e=>Ji(zr({},"__esModule",{value:!0}),e);var Hf={};st(Hf,{hmac:()=>pr,keys:()=>Bo,pbkdf2:()=>Io,randomBytes:()=>ao});var pr={};st(pr,{create:()=>jr});var ke=class extends Error{constructor(t="An error occurred while signing a message"){super(t),this.name="SigningError"}},Oe=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},dr=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var Ko={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new dr("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var G=Ko;var Do={SHA1:20,SHA256:32,SHA512:64};var ta={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},ea=async(e,t)=>{let r=await G.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,0,r.byteLength)};async function jr(e,t){let r=ta[e],n=await G.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{async digest(o){return ea(n,o)},length:Do[e]}}var Bo={};st(Bo,{generateEphemeralKeyPair:()=>Zi,generateKeyPair:()=>vf,generateKeyPairFromSeed:()=>If,keyStretcher:()=>zi,privateKeyFromCryptoKeyPair:()=>kf,privateKeyFromProtobuf:()=>Df,privateKeyFromRaw:()=>Uf,privateKeyToCryptoKeyPair:()=>Nf,privateKeyToProtobuf:()=>Rf,publicKeyFromMultihash:()=>Kf,publicKeyFromProtobuf:()=>Lf,publicKeyFromRaw:()=>_f,publicKeyToProtobuf:()=>te});var P=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},he=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}},Pe=class extends Error{static name="InvalidPrivateKeyError";constructor(t="Invalid private key"){super(t),this.name="InvalidPrivateKeyError"}};var Pt=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var Wr={};st(Wr,{base58btc:()=>Q,base58flickr:()=>ca});var Xf=new Uint8Array(0);function Uo(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Kt(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function Ro(e){return new TextEncoder().encode(e)}function To(e){return new TextDecoder().decode(e)}function ra(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var c=e.length,a=e.charAt(0),f=Math.log(c)/Math.log(256),l=Math.log(256)/Math.log(c);function u(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var v=0,A=0,y=0,S=d.length;y!==S&&d[y]===0;)y++,v++;for(var b=(S-y)*l+1>>>0,I=new Uint8Array(b);y!==S;){for(var T=d[y],O=0,H=b-1;(T!==0||O<A)&&H!==-1;H--,O++)T+=256*I[H]>>>0,I[H]=T%c>>>0,T=T/c>>>0;if(T!==0)throw new Error("Non-zero carry");A=O,y++}for(var w=b-A;w!==b&&I[w]===0;)w++;for(var g=a.repeat(v);w<b;++w)g+=e.charAt(I[w]);return g}function x(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var v=0;if(d[v]!==" "){for(var A=0,y=0;d[v]===a;)A++,v++;for(var S=(d.length-v)*f+1>>>0,b=new Uint8Array(S);d[v];){var I=r[d.charCodeAt(v)];if(I===255)return;for(var T=0,O=S-1;(I!==0||T<y)&&O!==-1;O--,T++)I+=c*b[O]>>>0,b[O]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");y=T,v++}if(d[v]!==" "){for(var H=S-y;H!==S&&b[H]===0;)H++;for(var w=new Uint8Array(A+(S-H)),g=A;H!==S;)w[g++]=b[H++];return w}}}function E(d){var v=x(d);if(v)return v;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:x,decode:E}}var na=ra,oa=na,No=oa;var Gr=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Yr=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ko(this,t)}},$r=class{decoders;constructor(t){this.decoders=t}or(t){return ko(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function ko(e,t){return new $r({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var Xr=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Gr(t,r,n),this.decoder=new Yr(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function de({name:e,prefix:t,encode:r,decode:n}){return new Xr(e,t,r,n)}function Ht({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=No(r,e);return de({prefix:t,name:e,encode:n,decode:s=>Kt(o(s))})}function sa(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,c=0,a=0;for(let f=0;f<o;++f){let l=t[e[f]];if(l===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|l,i+=r,i>=8&&(i-=8,s[a++]=255&c>>i)}if(i>=r||(255&c<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function ia(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,c=0;for(let a=0;a<e.length;++a)for(c=c<<8|e[a],i+=8;i>r;)i-=r,s+=t[o&c>>i];if(i!==0&&(s+=t[o&c<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function aa(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function W({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=aa(n);return de({prefix:t,name:e,encode(s){return ia(s,n,r)},decode(s){return sa(s,o,r,e)}})}var Q=Ht({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ca=Ht({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Jr={};st(Jr,{base32:()=>pe,base32hex:()=>ha,base32hexpad:()=>pa,base32hexpadupper:()=>ma,base32hexupper:()=>da,base32pad:()=>ua,base32padupper:()=>la,base32upper:()=>fa,base32z:()=>ya});var pe=W({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),fa=W({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ua=W({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),la=W({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ha=W({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),da=W({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pa=W({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ma=W({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ya=W({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Qr={};st(Qr,{base36:()=>He,base36upper:()=>ba});var He=Ht({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ba=Ht({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var xa=Ho,Oo=128,ga=127,wa=~ga,Ea=Math.pow(2,31);function Ho(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Ea;)t[r++]=e&255|Oo,e/=128;for(;e&wa;)t[r++]=e&255|Oo,e>>>=7;return t[r]=e|0,Ho.bytes=r-n+1,t}var Aa=tn,Sa=128,Po=127;function tn(e,n){var r=0,n=n||0,o=0,s=n,i,c=e.length;do{if(s>=c)throw tn.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&Po)<<o:(i&Po)*Math.pow(2,o),o+=7}while(i>=Sa);return tn.bytes=s-n,r}var Ba=Math.pow(2,7),va=Math.pow(2,14),Ia=Math.pow(2,21),La=Math.pow(2,28),_a=Math.pow(2,35),Ka=Math.pow(2,42),Da=Math.pow(2,49),Ua=Math.pow(2,56),Ra=Math.pow(2,63),Ta=function(e){return e<Ba?1:e<va?2:e<Ia?3:e<La?4:e<_a?5:e<Ka?6:e<Da?7:e<Ua?8:e<Ra?9:10},Ca={encode:xa,decode:Aa,encodingLength:Ta},Na=Ca,Me=Na;function qe(e,t=0){return[Me.decode(e,t),Me.decode.bytes]}function me(e,t,r=0){return Me.encode(e,t,r),t}function ye(e){return Me.encodingLength(e)}function vt(e,t){let r=t.byteLength,n=ye(e),o=n+ye(r),s=new Uint8Array(o+r);return me(e,s,0),me(r,s,n),s.set(t,o),new be(e,r,t,s)}function Mo(e){let t=Kt(e),[r,n]=qe(t),[o,s]=qe(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new be(r,o,i,t)}function qo(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Uo(e.bytes,r.bytes)}}var be=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function Vo(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return Oa(r,en(e),t??Q.encoder);default:return Pa(r,en(e),t??pe.encoder)}}var Zo=new WeakMap;function en(e){let t=Zo.get(e);if(t==null){let r=new Map;return Zo.set(e,r),r}return t}var gt=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Ze)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Ha)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=vt(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&qo(t.multihash,n.multihash)}toString(t){return Vo(this,t)}toJSON(){return{"/":Vo(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Fo(n,o,s.bytes))}else if(r[Ma]===!0){let{version:n,multihash:o,code:s}=r,i=Mo(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Ze)throw new Error(`Version 0 CID must use dag-pb (code: ${Ze}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Fo(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Ze,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=Kt(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new be(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[u,x]=qe(t.subarray(r));return r+=x,u},o=n(),s=Ze;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,c=n(),a=n(),f=r+a,l=f-i;return{version:o,codec:s,multihashCode:c,digestSize:a,multihashSize:l,size:f}}static parse(t,r){let[n,o]=ka(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return en(s).set(n,t),s}};function ka(e,t){switch(e[0]){case"Q":{let r=t??Q;return[Q.prefix,r.decode(`${Q.prefix}${e}`)]}case Q.prefix:{let r=t??Q;return[Q.prefix,r.decode(e)]}case pe.prefix:{let r=t??pe;return[pe.prefix,r.decode(e)]}case He.prefix:{let r=t??He;return[He.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function Oa(e,t,r){let{prefix:n}=r;if(n!==Q.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function Pa(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var Ze=112,Ha=18;function Fo(e,t,r){let n=ye(e),o=n+ye(t),s=new Uint8Array(o+r.byteLength);return me(e,s,0),me(t,s,n),s.set(r,o),s}var Ma=Symbol.for("@ipld/js-cid/CID");var rn={};st(rn,{identity:()=>Jt});var zo=0,qa="identity",jo=Kt;function Va(e,t){if(t?.truncate!=null&&t.truncate!==e.byteLength){if(t.truncate<0||t.truncate>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,t.truncate)}return vt(zo,jo(e))}var Jt={code:zo,name:qa,encode:jo,digest:Va};function it(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Dt(e=0){return new Uint8Array(e)}function mt(e=0){return new Uint8Array(e)}function It(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=mt(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var Yo=Symbol.for("@achingbrain/uint8arraylist");function Go(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function yr(e){return!!e?.[Yo]}var ct=class e{bufs;length;[Yo]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(yr(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(yr(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=Go(this.bufs,t);return r.buf[r.index]}set(t,r){let n=Go(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(yr(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return It(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:It(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],c=o,a=c+i.byteLength;if(o=a,t>=a)continue;let f=t>=c&&t<a,l=r>c&&r<=a;if(f&&l){if(t===c&&r===a){n.push(i);break}let u=t-c;n.push(i.subarray(u,u+(r-t)));break}if(f){if(t===0){n.push(i);continue}n.push(i.subarray(t-c));continue}if(l){if(r===a){n.push(i);break}n.push(i.subarray(0,r-c));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!yr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let u=0;u<s;u++)i[u]=-1;for(let u=0;u<o;u++)i[n[u]]=u;let c=i,a=this.byteLength-n.byteLength,f=n.byteLength-1,l;for(let u=r;u<=a;u+=l){l=0;for(let x=f;x>=0;x--){let E=this.get(u+x);if(n[x]!==E){l=Math.max(1,x-c[E]);break}}if(l===0)return u}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=mt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=Dt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=Dt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=Dt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=mt(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=Dt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=Dt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=Dt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=Dt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=Dt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!it(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var nn={};st(nn,{base10:()=>Za});var Za=Ht({prefix:"9",name:"base10",alphabet:"0123456789"});var on={};st(on,{base16:()=>Fa,base16upper:()=>za});var Fa=W({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),za=W({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var sn={};st(sn,{base2:()=>ja});var ja=W({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var an={};st(an,{base256emoji:()=>Wa});var $o=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ga=$o.reduce((e,t,r)=>(e[r]=t,e),[]),Ya=$o.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function $a(e){return e.reduce((t,r)=>(t+=Ga[r],t),"")}function Xa(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=Ya[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var Wa=de({prefix:"\u{1F680}",name:"base256emoji",encode:$a,decode:Xa});var fn={};st(fn,{base64:()=>cn,base64pad:()=>Ja,base64url:()=>Qa,base64urlpad:()=>tc});var cn=W({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ja=W({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Qa=W({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),tc=W({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var un={};st(un,{base8:()=>ec});var ec=W({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ln={};st(ln,{identity:()=>rc});var rc=de({prefix:"\0",name:"identity",encode:e=>To(e),decode:e=>Ro(e)});var Tu=new TextEncoder,Cu=new TextDecoder;var pn={};st(pn,{sha256:()=>br,sha512:()=>ic});var sc=20;function dn({name:e,code:t,encode:r,minDigestLength:n,maxDigestLength:o}){return new hn(e,t,r,n,o)}var hn=class{name;code;encode;minDigestLength;maxDigestLength;constructor(t,r,n,o,s){this.name=t,this.code=r,this.encode=n,this.minDigestLength=o??sc,this.maxDigestLength=s}digest(t,r){if(r?.truncate!=null){if(r.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&r.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(t instanceof Uint8Array){let n=this.encode(t);return n instanceof Uint8Array?Xo(n,this.code,r?.truncate):n.then(o=>Xo(o,this.code,r?.truncate))}else throw Error("Unknown type, must be binary type")}};function Xo(e,t,r){if(r!=null&&r!==e.byteLength){if(r>e.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,r)}return vt(t,e)}function Jo(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var br=dn({name:"sha2-256",code:18,encode:Jo("SHA-256")}),ic=dn({name:"sha2-512",code:19,encode:Jo("SHA-512")});var mn={...ln,...sn,...un,...nn,...on,...Jr,...Qr,...Wr,...fn,...an},ju={...pn,...rn};function ts(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var Qo=ts("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),yn=ts("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=mt(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),ac={utf8:Qo,"utf-8":Qo,hex:mn.base16,latin1:yn,ascii:yn,binary:yn,...mn},xr=ac;function F(e,t="utf8"){let r=xr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function V(e,t="utf8"){let r=xr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var cc=parseInt("11111",2),bn=parseInt("10000000",2),fc=parseInt("01111111",2),es={0:Fe,1:Fe,2:uc,3:dc,4:pc,5:hc,6:lc,16:Fe,22:Fe,48:Fe};function yt(e,t={offset:0}){let r=e[t.offset]&cc;if(t.offset++,es[r]!=null)return es[r](e,t);throw new Error("No decoder for tag "+r)}function ze(e,t){let r=0;if((e[t.offset]&bn)===bn){let n=e[t.offset]&fc,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function Fe(e,t){ze(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=yt(e,t);if(n===null)break;r.push(n)}return r}function uc(e,t){let r=ze(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function lc(e,t){let r=ze(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let c=`${s}.${i}`,a=[];for(;t.offset<n;){let f=e[t.offset];if(t.offset++,a.push(f&127),f<128){a.reverse();let l=0;for(let u=0;u<a.length;u++)l+=a[u]<<u*7;c+=`.${l}`,a=[]}}return c}function hc(e,t){return t.offset++,null}function dc(e,t){let r=ze(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function pc(e,t){let r=ze(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function mc(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new ct;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function gr(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=mc(e.byteLength);return new ct(Uint8Array.from([t.byteLength|bn]),t)}function ft(e){let t=new ct,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new ct(Uint8Array.from([2]),gr(t),t)}function je(e){let t=Uint8Array.from([0]),r=new ct(t,e);return new ct(Uint8Array.from([3]),gr(r),r)}function rs(e){return new ct(Uint8Array.from([4]),gr(e),e)}function wt(e,t=48){let r=new ct;for(let n of e)r.append(n);return new ct(Uint8Array.from([t]),gr(r),r)}var xn="1.2.840.10045.3.1.7",gn="1.3.132.0.34",wn="1.3.132.0.35";async function ns(e="P-256"){let t=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:e},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",t.publicKey),privateKey:await crypto.subtle.exportKey("jwk",t.privateKey)}}async function os(e,t,r){let n=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["sign"]);r?.signal?.throwIfAborted();let o=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function ss(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var yc=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),bc=Uint8Array.from([6,5,43,129,4,0,34]),xc=Uint8Array.from([6,5,43,129,4,0,35]),is={ext:!0,kty:"EC",crv:"P-256"},as={ext:!0,kty:"EC",crv:"P-384"},cs={ext:!0,kty:"EC",crv:"P-521"},xe=32,ge=48,we=66;function fs(e){let t=yt(e);return En(t)}function En(e){let t=e[1],r=V(t,"base64url"),n=e[2][1][0],o=1,s,i;if(t.byteLength===xe)return s=V(n.subarray(o,o+xe),"base64url"),i=V(n.subarray(o+xe),"base64url"),new Ut({...is,key_ops:["sign"],d:r,x:s,y:i});if(t.byteLength===ge)return s=V(n.subarray(o,o+ge),"base64url"),i=V(n.subarray(o+ge),"base64url"),new Ut({...as,key_ops:["sign"],d:r,x:s,y:i});if(t.byteLength===we)return s=V(n.subarray(o,o+we),"base64url"),i=V(n.subarray(o+we),"base64url"),new Ut({...cs,key_ops:["sign"],d:r,x:s,y:i});throw new P(`Private key length was wrong length, got ${t.byteLength}, expected 32, 48 or 66`)}function An(e){let t=yt(e);return Sn(t)}function Sn(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===xe*2+1)return n=V(t.subarray(r,r+xe),"base64url"),o=V(t.subarray(r+xe),"base64url"),new Qt({...is,key_ops:["verify"],x:n,y:o});if(t.byteLength===ge*2+1)return n=V(t.subarray(r,r+ge),"base64url"),o=V(t.subarray(r+ge),"base64url"),new Qt({...as,key_ops:["verify"],x:n,y:o});if(t.byteLength===we*2+1)return n=V(t.subarray(r,r+we),"base64url"),o=V(t.subarray(r+we),"base64url"),new Qt({...cs,key_ops:["verify"],x:n,y:o});throw new P(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function us(e){return wt([ft(Uint8Array.from([1])),rs(F(e.d??"","base64url")),wt([hs(e.crv)],160),wt([je(new ct(Uint8Array.from([4]),F(e.x??"","base64url"),F(e.y??"","base64url")))],161)]).subarray()}function ls(e){return wt([ft(Uint8Array.from([1])),wt([hs(e.crv)],160),wt([je(new ct(Uint8Array.from([4]),F(e.x??"","base64url"),F(e.y??"","base64url")))],161)]).subarray()}function hs(e){if(e==="P-256")return yc;if(e==="P-384")return bc;if(e==="P-521")return xc;throw new P(`Invalid curve ${e}`)}async function ds(e="P-256"){let t=await ns(e);return new Ut(t.privateKey)}var Qt=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=ls(this.jwk)),this._raw}toMultihash(){return Jt.digest(te(this))}toCID(){return gt.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}async verify(t,r,n){return ss(this.jwk,r,t,n)}},Ut=class{type="ECDSA";jwk;publicKey;_raw;constructor(t){this.jwk=t,this.publicKey=new Qt({crv:t.crv,ext:t.ext,key_ops:["verify"],kty:"EC",x:t.x,y:t.y})}get raw(){return this._raw==null&&(this._raw=us(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}async sign(t,r){return os(this.jwk,t,r)}};function ee(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ht(e,t=""){if(!Number.isSafeInteger(e)||e<0){let r=t&&`"${t}" `;throw new Error(`${r}expected integer >= 0, got ${e}`)}}function k(e,t,r=""){let n=ee(e),o=e?.length,s=t!==void 0;if(!n||s&&o!==t){let i=r&&`"${r}" `,c=s?` of length ${t}`:"",a=n?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return e}function Ee(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash must wrapped by utils.createHasher");ht(e.outputLen),ht(e.blockLen)}function Ae(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ms(e,t){k(e,void 0,"digestInto() output");let r=t.outputLen;if(e.length<r)throw new Error('"digestInto() output" expected to be of length >='+r)}function dt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Se(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Et(e,t){return e<<32-t|e>>>t}function wr(e,t){return e<<t|e>>>32-t>>>0}var ys=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",gc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Tt(e){if(k(e),ys)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=gc[e[r]];return t}var Rt={_0:48,_9:57,A:65,F:70,a:97,f:102};function ps(e){if(e>=Rt._0&&e<=Rt._9)return e-Rt._0;if(e>=Rt.A&&e<=Rt.F)return e-(Rt.A-10);if(e>=Rt.a&&e<=Rt.f)return e-(Rt.a-10)}function Ct(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ys)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=ps(e.charCodeAt(s)),c=ps(e.charCodeAt(s+1));if(i===void 0||c===void 0){let a=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function wc(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Bn(e,t=""){return typeof e=="string"?wc(e):k(e,void 0,t)}function pt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];k(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}function bs(e,t){if(t!==void 0&&{}.toString.call(t)!=="[object Object]")throw new Error("options must be object or undefined");return Object.assign(e,t)}function Ge(e,t={}){let r=(o,s)=>e(s).update(o).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=o=>e(o),Object.assign(r,t),Object.freeze(r)}function Mt(e=32){let t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}var vn=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])});function Er(e,t,r){return e&t^~e&r}function Ar(e,t,r){return e&t^e&r^t&r}var re=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(t,r,n,o){this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Se(this.buffer)}update(t){Ae(this),k(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=Se(t);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ae(this),ms(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,dt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let u=i;u<o;u++)r[u]=0;n.setBigUint64(o-8,BigInt(this.length*8),s),this.process(n,0);let c=Se(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let f=a/4,l=this.get();if(f>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)c.setUint32(4*u,l[u],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||=new this.constructor,t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=c,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Nt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var nt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var Sr=BigInt(4294967295),xs=BigInt(32);function Ec(e,t=!1){return t?{h:Number(e&Sr),l:Number(e>>xs&Sr)}:{h:Number(e>>xs&Sr)|0,l:Number(e&Sr)|0}}function gs(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:c}=Ec(e[s],t);[n[s],o[s]]=[i,c]}return[n,o]}var In=(e,t,r)=>e>>>r,Ln=(e,t,r)=>e<<32-r|t>>>r,ne=(e,t,r)=>e>>>r|t<<32-r,oe=(e,t,r)=>e<<32-r|t>>>r,Ye=(e,t,r)=>e<<64-r|t>>>r-32,$e=(e,t,r)=>e>>>r-32|t<<64-r;function Lt(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var ws=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),Es=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,As=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Ss=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,Bs=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),vs=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var Sc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),qt=new Uint32Array(64),_n=class extends re{constructor(t){super(64,t,8,!1)}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[t,r,n,o,s,i,c,a]}set(t,r,n,o,s,i,c,a){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,r){for(let u=0;u<16;u++,r+=4)qt[u]=t.getUint32(r,!1);for(let u=16;u<64;u++){let x=qt[u-15],E=qt[u-2],d=Et(x,7)^Et(x,18)^x>>>3,v=Et(E,17)^Et(E,19)^E>>>10;qt[u]=v+qt[u-7]+d+qt[u-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:f,H:l}=this;for(let u=0;u<64;u++){let x=Et(c,6)^Et(c,11)^Et(c,25),E=l+x+Er(c,a,f)+Sc[u]+qt[u]|0,v=(Et(n,2)^Et(n,13)^Et(n,22))+Ar(n,o,s)|0;l=f,f=a,a=c,c=i+E|0,i=s,s=o,o=n,n=E+v|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,l=l+this.H|0,this.set(n,o,s,i,c,a,f,l)}roundClean(){dt(qt)}destroy(){this.set(0,0,0,0,0,0,0,0),dt(this.buffer)}},Kn=class extends _n{A=Nt[0]|0;B=Nt[1]|0;C=Nt[2]|0;D=Nt[3]|0;E=Nt[4]|0;F=Nt[5]|0;G=Nt[6]|0;H=Nt[7]|0;constructor(){super(32)}};var Is=gs(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Bc=Is[0],vc=Is[1],Vt=new Uint32Array(80),Zt=new Uint32Array(80),Dn=class extends re{constructor(t){super(128,t,16,!1)}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:f,El:l,Fh:u,Fl:x,Gh:E,Gl:d,Hh:v,Hl:A}=this;return[t,r,n,o,s,i,c,a,f,l,u,x,E,d,v,A]}set(t,r,n,o,s,i,c,a,f,l,u,x,E,d,v,A){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=f|0,this.El=l|0,this.Fh=u|0,this.Fl=x|0,this.Gh=E|0,this.Gl=d|0,this.Hh=v|0,this.Hl=A|0}process(t,r){for(let b=0;b<16;b++,r+=4)Vt[b]=t.getUint32(r),Zt[b]=t.getUint32(r+=4);for(let b=16;b<80;b++){let I=Vt[b-15]|0,T=Zt[b-15]|0,O=ne(I,T,1)^ne(I,T,8)^In(I,T,7),H=oe(I,T,1)^oe(I,T,8)^Ln(I,T,7),w=Vt[b-2]|0,g=Zt[b-2]|0,C=ne(w,g,19)^Ye(w,g,61)^In(w,g,6),M=oe(w,g,19)^$e(w,g,61)^Ln(w,g,6),D=As(H,M,Zt[b-7],Zt[b-16]),p=Ss(D,O,C,Vt[b-7],Vt[b-16]);Vt[b]=p|0,Zt[b]=D|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:f,Dl:l,Eh:u,El:x,Fh:E,Fl:d,Gh:v,Gl:A,Hh:y,Hl:S}=this;for(let b=0;b<80;b++){let I=ne(u,x,14)^ne(u,x,18)^Ye(u,x,41),T=oe(u,x,14)^oe(u,x,18)^$e(u,x,41),O=u&E^~u&v,H=x&d^~x&A,w=Bs(S,T,H,vc[b],Zt[b]),g=vs(w,y,I,O,Bc[b],Vt[b]),C=w|0,M=ne(n,o,28)^Ye(n,o,34)^Ye(n,o,39),D=oe(n,o,28)^$e(n,o,34)^$e(n,o,39),p=n&s^n&c^s&c,m=o&i^o&a^i&a;y=v|0,S=A|0,v=E|0,A=d|0,E=u|0,d=x|0,{h:u,l:x}=Lt(f|0,l|0,g|0,C|0),f=c|0,l=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let h=ws(C,D,m);n=Es(h,g,M,p),o=h|0}({h:n,l:o}=Lt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=Lt(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=Lt(this.Ch|0,this.Cl|0,c|0,a|0),{h:f,l}=Lt(this.Dh|0,this.Dl|0,f|0,l|0),{h:u,l:x}=Lt(this.Eh|0,this.El|0,u|0,x|0),{h:E,l:d}=Lt(this.Fh|0,this.Fl|0,E|0,d|0),{h:v,l:A}=Lt(this.Gh|0,this.Gl|0,v|0,A|0),{h:y,l:S}=Lt(this.Hh|0,this.Hl|0,y|0,S|0),this.set(n,o,s,i,c,a,f,l,u,x,E,d,v,A,y,S)}roundClean(){dt(Vt,Zt)}destroy(){dt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Un=class extends Dn{Ah=nt[0]|0;Al=nt[1]|0;Bh=nt[2]|0;Bl=nt[3]|0;Ch=nt[4]|0;Cl=nt[5]|0;Dh=nt[6]|0;Dl=nt[7]|0;Eh=nt[8]|0;El=nt[9]|0;Fh=nt[10]|0;Fl=nt[11]|0;Gh=nt[12]|0;Gl=nt[13]|0;Hh=nt[14]|0;Hl=nt[15]|0;constructor(){super(64)}};var Ft=Ge(()=>new Kn,vn(1));var Br=Ge(()=>new Un,vn(3));var Tn=BigInt(0),Rn=BigInt(1);function kt(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}" `;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function Ls(e){if(typeof e=="bigint"){if(!vr(e))throw new Error("positive bigint expected, got "+e)}else ht(e);return e}function Xe(e){let t=Ls(e).toString(16);return t.length&1?"0"+t:t}function _s(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Tn:BigInt("0x"+e)}function Be(e){return _s(Tt(e))}function se(e){return _s(Tt(Lr(k(e)).reverse()))}function Ir(e,t){ht(t),e=Ls(e);let r=Ct(e.toString(16).padStart(t*2,"0"));if(r.length!==t)throw new Error("number too large");return r}function Cn(e,t){return Ir(e,t).reverse()}function Lr(e){return Uint8Array.from(e)}var vr=e=>typeof e=="bigint"&&Tn<=e;function Ic(e,t,r){return vr(e)&&vr(t)&&vr(r)&&t<=e&&e<r}function We(e,t,r,n){if(!Ic(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Nn(e){let t;for(t=0;e>Tn;e>>=Rn,t+=1);return t}var Je=e=>(Rn<<BigInt(e))-Rn;function Ks(e,t,r){if(ht(e,"hashLen"),ht(t,"qByteLen"),typeof r!="function")throw new Error("hmacFn must be a function");let n=A=>new Uint8Array(A),o=Uint8Array.of(),s=Uint8Array.of(0),i=Uint8Array.of(1),c=1e3,a=n(e),f=n(e),l=0,u=()=>{a.fill(1),f.fill(0),l=0},x=(...A)=>r(f,pt(a,...A)),E=(A=o)=>{f=x(s,A),a=x(),A.length!==0&&(f=x(i,A),a=x())},d=()=>{if(l++>=c)throw new Error("drbg: tried max amount of iterations");let A=0,y=[];for(;A<t;){a=x();let S=a.slice();y.push(S),A+=a.length}return pt(...y)};return(A,y)=>{u(),E(A);let S;for(;!(S=y(d()));)E();return u(),S}}function zt(e,t={},r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,i,c){let a=e[s];if(c&&a===void 0)return;let f=typeof a;if(f!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${f}`)}let o=(s,i)=>Object.entries(s).forEach(([c,a])=>n(c,a,i));o(t,!1),o(r,!0)}function ve(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var ut=BigInt(0),tt=BigInt(1),ie=BigInt(2),Rs=BigInt(3),Ts=BigInt(4),Cs=BigInt(5),Lc=BigInt(7),Ns=BigInt(8),_c=BigInt(9),ks=BigInt(16);function J(e,t){let r=e%t;return r>=ut?r:t+r}function j(e,t,r){let n=e;for(;t-- >ut;)n*=n,n%=r;return n}function Ds(e,t){if(e===ut)throw new Error("invert: expected non-zero number");if(t<=ut)throw new Error("invert: expected positive modulus, got "+t);let r=J(e,t),n=t,o=ut,s=tt,i=tt,c=ut;for(;r!==ut;){let f=n/r,l=n%r,u=o-i*f,x=s-c*f;n=r,r=l,o=i,s=c,i=u,c=x}if(n!==tt)throw new Error("invert: does not exist");return J(o,t)}function On(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function Os(e,t){let r=(e.ORDER+tt)/Ts,n=e.pow(t,r);return On(e,n,t),n}function Kc(e,t){let r=(e.ORDER-Cs)/Ns,n=e.mul(t,ie),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,ie),o),c=e.mul(s,e.sub(i,e.ONE));return On(e,c,t),c}function Dc(e){let t=Ie(e),r=Ps(e),n=r(t,t.neg(t.ONE)),o=r(t,n),s=r(t,t.neg(n)),i=(e+Lc)/ks;return(c,a)=>{let f=c.pow(a,i),l=c.mul(f,n),u=c.mul(f,o),x=c.mul(f,s),E=c.eql(c.sqr(l),a),d=c.eql(c.sqr(u),a);f=c.cmov(f,l,E),l=c.cmov(x,u,d);let v=c.eql(c.sqr(l),a),A=c.cmov(f,l,v);return On(c,A,a),A}}function Ps(e){if(e<Rs)throw new Error("sqrt is not defined for small field");let t=e-tt,r=0;for(;t%ie===ut;)t/=ie,r++;let n=ie,o=Ie(e);for(;Us(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Os;let s=o.pow(n,t),i=(t+tt)/ie;return function(a,f){if(a.is0(f))return f;if(Us(a,f)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,s),x=a.pow(f,t),E=a.pow(f,i);for(;!a.eql(x,a.ONE);){if(a.is0(x))return a.ZERO;let d=1,v=a.sqr(x);for(;!a.eql(v,a.ONE);)if(d++,v=a.sqr(v),d===l)throw new Error("Cannot find square root");let A=tt<<BigInt(l-d-1),y=a.pow(u,A);l=d,u=a.sqr(y),x=a.mul(x,u),E=a.mul(E,y)}return E}}function Uc(e){return e%Ts===Rs?Os:e%Ns===Cs?Kc:e%ks===_c?Dc(e):Ps(e)}var Hs=(e,t)=>(J(e,t)&tt)===tt,Rc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pn(e){let t={ORDER:"bigint",BYTES:"number",BITS:"number"},r=Rc.reduce((n,o)=>(n[o]="function",n),t);return zt(e,r),e}function Tc(e,t,r){if(r<ut)throw new Error("invalid exponent, negatives unsupported");if(r===ut)return e.ONE;if(r===tt)return t;let n=e.ONE,o=t;for(;r>ut;)r&tt&&(n=e.mul(n,o)),o=e.sqr(o),r>>=tt;return n}function Qe(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,c,a)=>e.is0(c)?i:(n[a]=i,e.mul(i,c)),e.ONE),s=e.inv(o);return t.reduceRight((i,c,a)=>e.is0(c)?i:(n[a]=e.mul(i,n[a]),e.mul(i,c)),s),n}function Us(e,t){let r=(e.ORDER-tt)/ie,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Cc(e,t){t!==void 0&&ht(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}var kn=class{ORDER;BITS;BYTES;isLE;ZERO=ut;ONE=tt;_lengths;_sqrt;_mod;constructor(t,r={}){if(t<=ut)throw new Error("invalid field: expected ORDER > 0, got "+t);let n;this.isLE=!1,r!=null&&typeof r=="object"&&(typeof r.BITS=="number"&&(n=r.BITS),typeof r.sqrt=="function"&&(this.sqrt=r.sqrt),typeof r.isLE=="boolean"&&(this.isLE=r.isLE),r.allowedLengths&&(this._lengths=r.allowedLengths?.slice()),typeof r.modFromBytes=="boolean"&&(this._mod=r.modFromBytes));let{nBitLength:o,nByteLength:s}=Cc(t,n);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=t,this.BITS=o,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(t){return J(t,this.ORDER)}isValid(t){if(typeof t!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof t);return ut<=t&&t<this.ORDER}is0(t){return t===ut}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}isOdd(t){return(t&tt)===tt}neg(t){return J(-t,this.ORDER)}eql(t,r){return t===r}sqr(t){return J(t*t,this.ORDER)}add(t,r){return J(t+r,this.ORDER)}sub(t,r){return J(t-r,this.ORDER)}mul(t,r){return J(t*r,this.ORDER)}pow(t,r){return Tc(this,t,r)}div(t,r){return J(t*Ds(r,this.ORDER),this.ORDER)}sqrN(t){return t*t}addN(t,r){return t+r}subN(t,r){return t-r}mulN(t,r){return t*r}inv(t){return Ds(t,this.ORDER)}sqrt(t){return this._sqrt||(this._sqrt=Uc(this.ORDER)),this._sqrt(this,t)}toBytes(t){return this.isLE?Cn(t,this.BYTES):Ir(t,this.BYTES)}fromBytes(t,r=!1){k(t);let{_lengths:n,BYTES:o,isLE:s,ORDER:i,_mod:c}=this;if(n){if(!n.includes(t.length)||t.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+t.length);let f=new Uint8Array(o);f.set(t,s?0:f.length-t.length),t=f}if(t.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+t.length);let a=s?se(t):Be(t);if(c&&(a=J(a,i)),!r&&!this.isValid(a))throw new Error("invalid field element: outside of range 0..ORDER");return a}invertBatch(t){return Qe(this,t)}cmov(t,r,n){return n?r:t}};function Ie(e,t={}){return new kn(e,t)}function Ms(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Hn(e){let t=Ms(e);return t+Math.ceil(t/2)}function Mn(e,t,r=!1){k(e);let n=e.length,o=Ms(t),s=Hn(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?se(e):Be(e),c=J(i,t-tt)+tt;return r?Cn(c,o):Ir(c,o)}var Le=BigInt(0),ae=BigInt(1);function tr(e,t){let r=t.negate();return e?r:t}function ce(e,t){let r=Qe(e.Fp,t.map(n=>n.Z));return t.map((n,o)=>e.fromAffine(n.toAffine(r[o])))}function Fs(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function qn(e,t){Fs(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=Je(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function qs(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(e&o),a=e>>i;c>n&&(c-=s,a+=ae);let f=t*n,l=f+Math.abs(c)-1,u=c===0,x=c<0,E=t%2!==0;return{nextN:a,offset:l,isZero:u,isNeg:x,isNegF:E,offsetF:f}}var Vn=new WeakMap,zs=new WeakMap;function Zn(e){return zs.get(e)||1}function Vs(e){if(e!==Le)throw new Error("invalid wNAF")}var _e=class{BASE;ZERO;Fn;bits;constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let o=t;for(;r>Le;)r&ae&&(n=n.add(o)),o=o.double(),r>>=ae;return n}precomputeWindow(t,r){let{windows:n,windowSize:o}=qn(r,this.bits),s=[],i=t,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let f=1;f<o;f++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=qn(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:f,isZero:l,isNeg:u,isNegF:x,offsetF:E}=qs(n,c,i);n=a,l?s=s.add(tr(x,r[E])):o=o.add(tr(u,r[f]))}return Vs(n),{p:o,f:s}}wNAFUnsafe(t,r,n,o=this.ZERO){let s=qn(t,this.bits);for(let i=0;i<s.windows&&n!==Le;i++){let{nextN:c,offset:a,isZero:f,isNeg:l}=qs(n,i,s);if(n=c,!f){let u=r[a];o=o.add(l?u.negate():u)}}return Vs(n),o}getPrecomputes(t,r,n){let o=Vn.get(r);return o||(o=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(o=n(o)),Vn.set(r,o))),o}cached(t,r,n){let o=Zn(t);return this.wNAF(o,this.getPrecomputes(o,t,n),r)}unsafe(t,r,n,o){let s=Zn(t);return s===1?this._unsafeLadder(t,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,n),r,o)}createCache(t,r){Fs(r,this.bits),zs.set(t,r),Vn.delete(t)}hasCache(t){return Zn(t)!==1}};function js(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>Le||n>Le;)r&ae&&(s=s.add(o)),n&ae&&(i=i.add(o)),o=o.double(),r>>=ae,n>>=ae;return{p1:s,p2:i}}function Zs(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Pn(t),t}else return Ie(e,{isLE:r})}function _r(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let f=t[a];if(!(typeof f=="bigint"&&f>Le))throw new Error(`CURVE.${a} must be positive bigint`)}let o=Zs(t.p,r.Fp,n),s=Zs(t.n,r.Fn,n),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}function Kr(e,t){return function(n){let o=e(n);return{secretKey:o,publicKey:t(o)}}}var jt=BigInt(0),et=BigInt(1),Fn=BigInt(2),Nc=BigInt(8);function kc(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),c=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,c)}function Gs(e,t={}){let r=_r("edwards",e,t,t.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;zt(t,{},{uvRatio:"function"});let c=Fn<<BigInt(o.BYTES*8)-et,a=A=>n.create(A),f=t.uvRatio||((A,y)=>{try{return{isValid:!0,value:n.sqrt(n.div(A,y))}}catch{return{isValid:!1,value:jt}}});if(!kc(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function l(A,y,S=!1){let b=S?et:jt;return We("coordinate "+A,y,b,c),y}function u(A){if(!(A instanceof d))throw new Error("EdwardsPoint expected")}let x=ve((A,y)=>{let{X:S,Y:b,Z:I}=A,T=A.is0();y==null&&(y=T?Nc:n.inv(I));let O=a(S*y),H=a(b*y),w=n.mul(I,y);if(T)return{x:jt,y:et};if(w!==et)throw new Error("invZ was invalid");return{x:O,y:H}}),E=ve(A=>{let{a:y,d:S}=s;if(A.is0())throw new Error("bad point: ZERO");let{X:b,Y:I,Z:T,T:O}=A,H=a(b*b),w=a(I*I),g=a(T*T),C=a(g*g),M=a(H*y),D=a(g*a(M+w)),p=a(C+a(S*a(H*w)));if(D!==p)throw new Error("bad point: equation left != right (1)");let m=a(b*I),h=a(T*O);if(m!==h)throw new Error("bad point: equation left != right (2)");return!0});class d{static BASE=new d(s.Gx,s.Gy,et,a(s.Gx*s.Gy));static ZERO=new d(jt,et,et,jt);static Fp=n;static Fn=o;X;Y;Z;T;constructor(y,S,b,I){this.X=l("x",y),this.Y=l("y",S),this.Z=l("z",b,!0),this.T=l("t",I),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){if(y instanceof d)throw new Error("extended point not allowed");let{x:S,y:b}=y||{};return l("x",S),l("y",b),new d(S,b,et,a(S*b))}static fromBytes(y,S=!1){let b=n.BYTES,{a:I,d:T}=s;y=Lr(k(y,b,"point")),kt(S,"zip215");let O=Lr(y),H=y[b-1];O[b-1]=H&-129;let w=se(O),g=S?c:n.ORDER;We("point.y",w,jt,g);let C=a(w*w),M=a(C-et),D=a(T*C-I),{isValid:p,value:m}=f(M,D);if(!p)throw new Error("bad point: invalid y coordinate");let h=(m&et)===et,B=(H&128)!==0;if(!S&&m===jt&&B)throw new Error("bad point: x=0 and x_0=1");return B!==h&&(m=a(-m)),d.fromAffine({x:m,y:w})}static fromHex(y,S=!1){return d.fromBytes(Ct(y),S)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,S=!0){return v.createCache(this,y),S||this.multiply(Fn),this}assertValidity(){E(this)}equals(y){u(y);let{X:S,Y:b,Z:I}=this,{X:T,Y:O,Z:H}=y,w=a(S*H),g=a(T*I),C=a(b*H),M=a(O*I);return w===g&&C===M}is0(){return this.equals(d.ZERO)}negate(){return new d(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:y}=s,{X:S,Y:b,Z:I}=this,T=a(S*S),O=a(b*b),H=a(Fn*a(I*I)),w=a(y*T),g=S+b,C=a(a(g*g)-T-O),M=w+O,D=M-H,p=w-O,m=a(C*D),h=a(M*p),B=a(C*p),L=a(D*M);return new d(m,h,L,B)}add(y){u(y);let{a:S,d:b}=s,{X:I,Y:T,Z:O,T:H}=this,{X:w,Y:g,Z:C,T:M}=y,D=a(I*w),p=a(T*g),m=a(H*b*M),h=a(O*C),B=a((I+T)*(w+g)-D-p),L=h-m,K=h+m,U=a(p-S*D),_=a(B*L),R=a(K*U),N=a(B*U),Y=a(L*K);return new d(_,R,Y,N)}subtract(y){return this.add(y.negate())}multiply(y){if(!o.isValidNot0(y))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:S,f:b}=v.cached(this,y,I=>ce(d,I));return ce(d,[S,b])[0]}multiplyUnsafe(y,S=d.ZERO){if(!o.isValid(y))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return y===jt?d.ZERO:this.is0()||y===et?this:v.unsafe(this,y,b=>ce(d,b),S)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return v.unsafe(this,s.n).is0()}toAffine(y){return x(this,y)}clearCofactor(){return i===et?this:this.multiplyUnsafe(i)}toBytes(){let{x:y,y:S}=this.toAffine(),b=n.toBytes(S);return b[b.length-1]|=y&et?128:0,b}toHex(){return Tt(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let v=new _e(d,o.BITS);return d.BASE.precompute(8),d}function Ys(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');zt(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=e,c=r.randomBytes||Mt,a=r.adjustScalarBytes||(w=>w),f=r.domain||((w,g,C)=>{if(kt(C,"phflag"),g.length||C)throw new Error("Contexts/pre-hash are not supported");return w});function l(w){return i.create(se(w))}function u(w){let g=b.secretKey;k(w,b.secretKey,"secretKey");let C=k(t(w),2*g,"hashedSecretKey"),M=a(C.slice(0,g)),D=C.slice(g,2*g),p=l(M);return{head:M,prefix:D,scalar:p}}function x(w){let{head:g,prefix:C,scalar:M}=u(w),D=o.multiply(M),p=D.toBytes();return{head:g,prefix:C,scalar:M,point:D,pointBytes:p}}function E(w){return x(w).pointBytes}function d(w=Uint8Array.of(),...g){let C=pt(...g);return l(t(f(C,k(w,void 0,"context"),!!n)))}function v(w,g,C={}){w=k(w,void 0,"message"),n&&(w=n(w));let{prefix:M,scalar:D,pointBytes:p}=x(g),m=d(C.context,M,w),h=o.multiply(m).toBytes(),B=d(C.context,h,p,w),L=i.create(m+B*D);if(!i.isValid(L))throw new Error("sign failed: invalid s");let K=pt(h,i.toBytes(L));return k(K,b.signature,"result")}let A={zip215:!0};function y(w,g,C,M=A){let{context:D,zip215:p}=M,m=b.signature;w=k(w,m,"signature"),g=k(g,void 0,"message"),C=k(C,b.publicKey,"publicKey"),p!==void 0&&kt(p,"zip215"),n&&(g=n(g));let h=m/2,B=w.subarray(0,h),L=se(w.subarray(h,m)),K,U,_;try{K=e.fromBytes(C,p),U=e.fromBytes(B,p),_=o.multiplyUnsafe(L)}catch{return!1}if(!p&&K.isSmallOrder())return!1;let R=d(D,U.toBytes(),K.toBytes(),g);return U.add(K.multiplyUnsafe(R)).subtract(_).clearCofactor().is0()}let S=s.BYTES,b={secretKey:S,publicKey:S,signature:2*S,seed:S};function I(w=c(b.seed)){return k(w,b.seed,"seed")}function T(w){return ee(w)&&w.length===i.BYTES}function O(w,g){try{return!!e.fromBytes(w,g)}catch{return!1}}let H={getExtendedPublicKey:x,randomSecretKey:I,isValidSecretKey:T,isValidPublicKey:O,toMontgomery(w){let{y:g}=e.fromBytes(w),C=b.publicKey,M=C===32;if(!M&&C!==57)throw new Error("only defined for 25519 and 448");let D=M?s.div(et+g,et-g):s.div(g-et,g+et);return s.toBytes(D)},toMontgomerySecret(w){let g=b.secretKey;k(w,g);let C=t(w.subarray(0,g));return a(C).subarray(0,g)}};return Object.freeze({keygen:Kr(I,E),getPublicKey:E,sign:v,verify:y,utils:H,Point:e,lengths:b})}var Oc=BigInt(1),$s=BigInt(2);var Pc=BigInt(5),Hc=BigInt(8),zn=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Mc={p:zn,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Hc,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function qc(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=zn,c=e*e%s*e%s,a=j(c,$s,s)*c%s,f=j(a,Oc,s)*e%s,l=j(f,Pc,s)*f%s,u=j(l,t,s)*l%s,x=j(u,r,s)*u%s,E=j(x,n,s)*x%s,d=j(E,o,s)*E%s,v=j(d,o,s)*E%s,A=j(v,t,s)*l%s;return{pow_p_5_8:j(A,$s,s)*e%s,b2:c}}function Vc(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Xs=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Zc(e,t){let r=zn,n=J(t*t*t,r),o=J(n*n*t,r),s=qc(e*o).pow_p_5_8,i=J(e*n*s,r),c=J(t*i*i,r),a=i,f=J(i*Xs,r),l=c===e,u=c===J(-e,r),x=c===J(-e*Xs,r);return l&&(i=a),(u||x)&&(i=f),Hs(i,r)&&(i=J(-i,r)),{isValid:l||u,value:i}}var Fc=Gs(Mc,{uvRatio:Zc});function zc(e){return Ys(Fc,Br,Object.assign({adjustScalarBytes:Vc},e))}var Ke=zc({});var Gt=32,bt=64,Dr=32;var De,Ws=(async()=>{try{return await G.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function Js(){let e=Ke.utils.randomSecretKey(),t=Ke.getPublicKey(e);return{privateKey:ri(e,t),publicKey:t}}function Qs(e){if(e.length!==Dr)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let t=e,r=Ke.getPublicKey(t);return{privateKey:ri(t,r),publicKey:r}}async function jc(e,t){let r;e.length===bt?r=e.subarray(0,32):r=e;let n={crv:"Ed25519",kty:"OKP",x:V(e.subarray(32),"base64url"),d:V(r,"base64url"),ext:!0,key_ops:["sign"]},o=await G.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),s=await G.get().subtle.sign({name:"Ed25519"},o,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(s,0,s.byteLength)}function Gc(e,t){let r=e.subarray(0,Dr);return Ke.sign(t instanceof Uint8Array?t:t.subarray(),r)}async function ti(e,t){return De==null&&(De=await Ws),De?jc(e,t):Gc(e,t)}async function Yc(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await G.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await G.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function $c(e,t,r){return Ke.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function ei(e,t,r){return De==null&&(De=await Ws),De?Yc(e,t,r):$c(e,t,r)}function ri(e,t){let r=new Uint8Array(bt);for(let n=0;n<Dr;n++)r[n]=e[n],r[Dr+n]=t[n];return r}function jn(e,t){let r=F(e,"base64urlpad");if(t!=null){if(r.length>t)throw new Error("byte array longer than desired length");r=It([new Uint8Array(t-r.length),r])}return r}function Ue(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var er=class{type="Ed25519";raw;constructor(t){this.raw=Re(t,Gt)}toMultihash(){return Jt.digest(te(this))}toCID(){return gt.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=ei(this.raw,r,t);return Ue(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}},fe=class{type="Ed25519";raw;publicKey;constructor(t,r){this.raw=Re(t,bt),this.publicKey=new er(r)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}sign(t,r){r?.signal?.throwIfAborted();let n=ti(this.raw,t);return Ue(n)?n.then(o=>(r?.signal?.throwIfAborted(),o)):(r?.signal?.throwIfAborted(),n)}};function Gn(e){if(e.length>bt){e=Re(e,bt+Gt);let n=e.subarray(0,bt),o=e.subarray(bt,e.length);return new fe(n,o)}e=Re(e,bt);let t=e.subarray(0,bt),r=e.subarray(Gt);return new fe(t,r)}function Ur(e){return e=Re(e,Gt),new er(e)}async function oi(){let{privateKey:e,publicKey:t}=Js();return new fe(e,t)}async function si(e){let{privateKey:t,publicKey:r}=Qs(e);return new fe(t,r)}function Re(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new P(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var Xc=Math.pow(2,7),Wc=Math.pow(2,14),Jc=Math.pow(2,21),ii=Math.pow(2,28),ai=Math.pow(2,35),ci=Math.pow(2,42),fi=Math.pow(2,49),lt=128,Yt=127;function rr(e){if(e<Xc)return 1;if(e<Wc)return 2;if(e<Jc)return 3;if(e<ii)return 4;if(e<ai)return 5;if(e<ci)return 6;if(e<fi)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function ui(e,t,r=0){switch(rr(e)){case 8:t[r++]=e&255|lt,e/=128;case 7:t[r++]=e&255|lt,e/=128;case 6:t[r++]=e&255|lt,e/=128;case 5:t[r++]=e&255|lt,e/=128;case 4:t[r++]=e&255|lt,e>>>=7;case 3:t[r++]=e&255|lt,e>>>=7;case 2:t[r++]=e&255|lt,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function li(e,t){let r=e[t],n=0;if(n+=r&Yt,r<lt||(r=e[t+1],n+=(r&Yt)<<7,r<lt)||(r=e[t+2],n+=(r&Yt)<<14,r<lt)||(r=e[t+3],n+=(r&Yt)<<21,r<lt)||(r=e[t+4],n+=(r&Yt)*ii,r<lt)||(r=e[t+5],n+=(r&Yt)*ai,r<lt)||(r=e[t+6],n+=(r&Yt)*ci,r<lt)||(r=e[t+7],n+=(r&Yt)*fi,r<lt))return n;throw new RangeError("Could not decode varint")}var Yn=new Float32Array([-0]),$t=new Uint8Array(Yn.buffer);function hi(e,t,r){Yn[0]=e,t[r]=$t[0],t[r+1]=$t[1],t[r+2]=$t[2],t[r+3]=$t[3]}function di(e,t){return $t[0]=e[t],$t[1]=e[t+1],$t[2]=e[t+2],$t[3]=e[t+3],Yn[0]}var $n=new Float64Array([-0]),at=new Uint8Array($n.buffer);function pi(e,t,r){$n[0]=e,t[r]=at[0],t[r+1]=at[1],t[r+2]=at[2],t[r+3]=at[3],t[r+4]=at[4],t[r+5]=at[5],t[r+6]=at[6],t[r+7]=at[7]}function mi(e,t){return at[0]=e[t],at[1]=e[t+1],at[2]=e[t+2],at[3]=e[t+3],at[4]=e[t+4],at[5]=e[t+5],at[6]=e[t+6],at[7]=e[t+7],$n[0]}var Qc=BigInt(Number.MAX_SAFE_INTEGER),tf=BigInt(Number.MIN_SAFE_INTEGER),xt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return ue;if(t<Qc&&t>tf)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>yi&&(o=0n,++n>yi&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return ue;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):ue}},ue=new xt(0,0);ue.toBigInt=function(){return 0n};ue.zzEncode=ue.zzDecode=function(){return this};ue.length=function(){return 1};var yi=4294967296n;function bi(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function xi(e,t,r){if(r-t<1)return"";let o,s=[],i=0,c;for(;t<r;)c=e[t++],c<128?s[i++]=c:c>191&&c<224?s[i++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(c>>10),s[i++]=56320+(c&1023)):s[i++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function Xn(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function At(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function Rr(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Wn=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,At(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw At(this,4);return Rr(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw At(this,4);return Rr(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw At(this,4);let t=di(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw At(this,4);let t=mi(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw At(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return xi(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw At(this,t);this.pos+=t}else do if(this.pos>=this.len)throw At(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new xt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw At(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw At(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw At(this,8);let t=Rr(this.buf,this.pos+=4),r=Rr(this.buf,this.pos+=4);return new xt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=li(this.buf,this.pos);return this.pos+=rr(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Jn(e){return new Wn(e instanceof Uint8Array?e:e.subarray())}function Tr(e,t,r){let n=Jn(e);return t.decode(n,void 0,r)}function Qn(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return mt(i);o+i>t&&(n=mt(t),o=0);let c=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),c}}var le=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function to(){}var ro=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},ef=Qn();function rf(e){return globalThis.Buffer!=null?mt(e):ef(e)}var or=class{len;head;tail;states;constructor(){this.len=0,this.head=new le(to,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new le(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new no((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Cr,10,xt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=xt.fromBigInt(t);return this._push(Cr,r.length(),r)}uint64Number(t){return this._push(ui,rr(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=xt.fromBigInt(t).zzEncode();return this._push(Cr,r.length(),r)}sint64Number(t){let r=xt.fromNumber(t).zzEncode();return this._push(Cr,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(eo,1,t?1:0)}fixed32(t){return this._push(nr,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=xt.fromBigInt(t);return this._push(nr,4,r.lo)._push(nr,4,r.hi)}fixed64Number(t){let r=xt.fromNumber(t);return this._push(nr,4,r.lo)._push(nr,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(hi,4,t)}double(t){return this._push(pi,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(eo,1,0):this.uint32(r)._push(of,r,t)}string(t){let r=bi(t);return r!==0?this.uint32(r)._push(Xn,r,t):this._push(eo,1,0)}fork(){return this.states=new ro(this),this.head=this.tail=new le(to,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new le(to,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=rf(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function eo(e,t,r){t[r]=e&255}function nf(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var no=class extends le{next;constructor(t,r){super(nf,t,r),this.next=void 0}};function Cr(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function nr(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function of(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(or.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(sf,t,e),this},or.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(af,t,e),this});function sf(e,t,r){t.set(e,r)}function af(e,t,r){e.length<40?Xn(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(F(e),r)}function oo(){return new or}function Nr(e,t){let r=oo();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Te;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Te||(Te={}));function kr(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function so(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let c=t(s);i.int32(c)},n=function(s){let i=s.int32();return t(i)};return kr("enum",Te.VARINT,r,n)}function Or(e,t){return kr("message",Te.LENGTH_DELIMITED,e,t)}var Z;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(Z||(Z={}));var io;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(io||(io={}));(function(e){e.codec=()=>so(io)})(Z||(Z={}));var _t;(function(e){let t;e.codec=()=>(t==null&&(t=Or((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),Z.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=Z.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Nr(r,e.codec()),e.decode=(r,n)=>Tr(r,e.codec(),n)})(_t||(_t={}));var sr;(function(e){let t;e.codec=()=>(t==null&&(t=Or((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),Z.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let c=r.uint32();switch(c>>>3){case 1:{s.Type=Z.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(c&7);break}}}return s})),t),e.encode=r=>Nr(r,e.codec()),e.decode=(r,n)=>Tr(r,e.codec(),n)})(sr||(sr={}));function ao(e){if(isNaN(e)||e<=0)throw new P("random bytes length must be a Number bigger than 0");return Mt(e)}var ar={};st(ar,{MAX_RSA_KEY_SIZE:()=>co,generateRSAKeyPair:()=>yo,jwkToJWKKeyPair:()=>Si,jwkToPkcs1:()=>lf,jwkToPkix:()=>ho,jwkToRSAPrivateKey:()=>Mr,pkcs1MessageToJwk:()=>uo,pkcs1MessageToRSAPrivateKey:()=>Pr,pkcs1ToJwk:()=>uf,pkcs1ToRSAPrivateKey:()=>po,pkixMessageToJwk:()=>lo,pkixMessageToRSAPublicKey:()=>Hr,pkixToJwk:()=>hf,pkixToRSAPublicKey:()=>mo});var Ce=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=ar.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return gt.createV1(114,this._multihash)}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}verify(t,r,n){return Ai(this.jwk,r,t,n)}},ir=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=ar.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}sign(t,r){return Ei(this.jwk,t,r)}};var co=8192,fo=18,cf=1062,ff=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function uf(e){let t=yt(e);return uo(t)}function uo(e){return{n:V(e[1],"base64url"),e:V(e[2],"base64url"),d:V(e[3],"base64url"),p:V(e[4],"base64url"),q:V(e[5],"base64url"),dp:V(e[6],"base64url"),dq:V(e[7],"base64url"),qi:V(e[8],"base64url"),kty:"RSA"}}function lf(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new P("JWK was missing components");return wt([ft(Uint8Array.from([0])),ft(F(e.n,"base64url")),ft(F(e.e,"base64url")),ft(F(e.d,"base64url")),ft(F(e.p,"base64url")),ft(F(e.q,"base64url")),ft(F(e.dp,"base64url")),ft(F(e.dq,"base64url")),ft(F(e.qi,"base64url"))]).subarray()}function hf(e){let t=yt(e,{offset:0});return lo(t)}function lo(e){let t=yt(e[1],{offset:0});return{kty:"RSA",n:V(t[0],"base64url"),e:V(t[1],"base64url")}}function ho(e){if(e.n==null||e.e==null)throw new P("JWK was missing components");return wt([ff,je(wt([ft(F(e.n,"base64url")),ft(F(e.e,"base64url"))]))]).subarray()}function po(e){let t=yt(e);return Pr(t)}function Pr(e){let t=uo(e);return Mr(t)}function mo(e,t){if(e.byteLength>=cf)throw new he("Key size is too large");let r=yt(e,{offset:0});return Hr(r,e,t)}function Hr(e,t,r){let n=lo(e);if(r==null){let o=Ft(_t.encode({Type:Z.RSA,Data:t}));r=vt(fo,o)}return new Ce(n,r)}function Mr(e){if(vi(e)>co)throw new P("Key size is too large");let t=Si(e),r=Ft(_t.encode({Type:Z.RSA,Data:ho(t.publicKey)})),n=vt(fo,r);return new ir(t.privateKey,new Ce(t.publicKey,n))}async function yo(e){if(e>co)throw new P("Key size is too large");let t=await Bi(e),r=Ft(_t.encode({Type:Z.RSA,Data:ho(t.publicKey)})),n=vt(fo,r);return new ir(t.privateKey,new Ce(t.publicKey,n))}function Si(e){if(e==null)throw new P("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}var Ii="1.2.840.113549.1.1.1";async function Bi(e,t){let r=await G.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await df(r,t);return{privateKey:n[0],publicKey:n[1]}}async function Ei(e,t,r){let n=await G.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await G.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function Ai(e,t,r,n){let o=await G.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await G.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function df(e,t){if(e.privateKey==null||e.publicKey==null)throw new P("Private and public key are required");let r=await Promise.all([G.get().subtle.exportKey("jwk",e.privateKey),G.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function vi(e){if(e.kty!=="RSA")throw new P("invalid key type");if(e.n==null)throw new P("invalid key modulus");return F(e.n,"base64url").length*8}var qr=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(t,r){if(Ee(t),k(r,void 0,"key"),this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,o=new Uint8Array(n);o.set(r.length>n?t.create().update(r).digest():r);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),dt(o)}update(t){return Ae(this),this.iHash.update(t),this}digestInto(t){Ae(this),k(t,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||=Object.create(Object.getPrototypeOf(this),{});let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},cr=(e,t,r)=>new qr(e,t).update(r).digest();cr.create=(e,t)=>new qr(e,t);var Li=(e,t)=>(e+(e>=0?t:-t)/_i)/t;function pf(e,t,r){let[[n,o],[s,i]]=t,c=Li(i*e,r),a=Li(-o*e,r),f=e-c*n-a*s,l=-c*o-a*i,u=f<Ot,x=l<Ot;u&&(f=-f),x&&(l=-l);let E=Je(Math.ceil(Nn(r)/2))+Ne;if(f<Ot||f>=E||l<Ot||l>=E)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:u,k1:f,k2neg:x,k2:l}}function xo(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function bo(e,t){let r={};for(let n of Object.keys(t))r[n]=e[n]===void 0?t[n]:e[n];return kt(r.lowS,"lowS"),kt(r.prehash,"prehash"),r.format!==void 0&&xo(r.format),r}var go=class extends Error{constructor(t=""){super(t)}},Xt={Err:go,_tlv:{encode:(e,t)=>{let{Err:r}=Xt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=Xe(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?Xe(o.length/2|128):"";return Xe(e)+s+o+t},decode(e,t){let{Err:r}=Xt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let a=o&127;if(!a)throw new r("tlv.decode(long): indefinite length not supported");if(a>4)throw new r("tlv.decode(long): byte length is too big");let f=t.subarray(n,n+a);if(f.length!==a)throw new r("tlv.decode: length bytes not complete");if(f[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of f)i=i<<8|l;if(n+=a,i<128)throw new r("tlv.decode(long): not minimal encoding")}let c=t.subarray(n,n+i);if(c.length!==i)throw new r("tlv.decode: wrong value length");return{v:c,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=Xt;if(e<Ot)throw new t("integer: negative integers are not allowed");let r=Xe(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=Xt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Be(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=Xt,o=k(e,void 0,"signature"),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:c,l:a}=n.decode(2,s),{v:f,l}=n.decode(2,a);if(l.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(c),s:r.decode(f)}},hexFromSig(e){let{_tlv:t,_int:r}=Xt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Ot=BigInt(0),Ne=BigInt(1),_i=BigInt(2),Vr=BigInt(3),mf=BigInt(4);function Ki(e,t={}){let r=_r("weierstrass",e,t),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;zt(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:a}=t;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let f=Ui(n,o);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function u(D,p,m){let{x:h,y:B}=p.toAffine(),L=n.toBytes(h);if(kt(m,"isCompressed"),m){l();let K=!n.isOdd(B);return pt(Di(K),L)}else return pt(Uint8Array.of(4),L,n.toBytes(B))}function x(D){k(D,void 0,"Point");let{publicKey:p,publicKeyUncompressed:m}=f,h=D.length,B=D[0],L=D.subarray(1);if(h===p&&(B===2||B===3)){let K=n.fromBytes(L);if(!n.isValid(K))throw new Error("bad point: is not on curve, wrong x");let U=v(K),_;try{_=n.sqrt(U)}catch(Y){let z=Y instanceof Error?": "+Y.message:"";throw new Error("bad point: is not on curve, sqrt error"+z)}l();let R=n.isOdd(_);return(B&1)===1!==R&&(_=n.neg(_)),{x:K,y:_}}else if(h===m&&B===4){let K=n.BYTES,U=n.fromBytes(L.subarray(0,K)),_=n.fromBytes(L.subarray(K,K*2));if(!A(U,_))throw new Error("bad point: is not on curve");return{x:U,y:_}}else throw new Error(`bad point: got length ${h}, expected compressed=${p} or uncompressed=${m}`)}let E=t.toBytes||u,d=t.fromBytes||x;function v(D){let p=n.sqr(D),m=n.mul(p,D);return n.add(n.add(m,n.mul(D,s.a)),s.b)}function A(D,p){let m=n.sqr(p),h=v(D);return n.eql(m,h)}if(!A(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let y=n.mul(n.pow(s.a,Vr),mf),S=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(y,S)))throw new Error("bad curve params: a or b");function b(D,p,m=!1){if(!n.isValid(p)||m&&n.is0(p))throw new Error(`bad point coordinate ${D}`);return p}function I(D){if(!(D instanceof g))throw new Error("Weierstrass Point expected")}function T(D){if(!a||!a.basises)throw new Error("no endo");return pf(D,a.basises,o.ORDER)}let O=ve((D,p)=>{let{X:m,Y:h,Z:B}=D;if(n.eql(B,n.ONE))return{x:m,y:h};let L=D.is0();p==null&&(p=L?n.ONE:n.inv(B));let K=n.mul(m,p),U=n.mul(h,p),_=n.mul(B,p);if(L)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:K,y:U}}),H=ve(D=>{if(D.is0()){if(t.allowInfinityPoint&&!n.is0(D.Y))return;throw new Error("bad point: ZERO")}let{x:p,y:m}=D.toAffine();if(!n.isValid(p)||!n.isValid(m))throw new Error("bad point: x or y not field elements");if(!A(p,m))throw new Error("bad point: equation left != right");if(!D.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function w(D,p,m,h,B){return m=new g(n.mul(m.X,D),m.Y,m.Z),p=tr(h,p),m=tr(B,m),p.add(m)}class g{static BASE=new g(s.Gx,s.Gy,n.ONE);static ZERO=new g(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(p,m,h){this.X=b("x",p),this.Y=b("y",m,!0),this.Z=b("z",h),Object.freeze(this)}static CURVE(){return s}static fromAffine(p){let{x:m,y:h}=p||{};if(!p||!n.isValid(m)||!n.isValid(h))throw new Error("invalid affine point");if(p instanceof g)throw new Error("projective point not allowed");return n.is0(m)&&n.is0(h)?g.ZERO:new g(m,h,n.ONE)}static fromBytes(p){let m=g.fromAffine(d(k(p,void 0,"point")));return m.assertValidity(),m}static fromHex(p){return g.fromBytes(Ct(p))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(p=8,m=!0){return M.createCache(this,p),m||this.multiply(Vr),this}assertValidity(){H(this)}hasEvenY(){let{y:p}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(p)}equals(p){I(p);let{X:m,Y:h,Z:B}=this,{X:L,Y:K,Z:U}=p,_=n.eql(n.mul(m,U),n.mul(L,B)),R=n.eql(n.mul(h,U),n.mul(K,B));return _&&R}negate(){return new g(this.X,n.neg(this.Y),this.Z)}double(){let{a:p,b:m}=s,h=n.mul(m,Vr),{X:B,Y:L,Z:K}=this,U=n.ZERO,_=n.ZERO,R=n.ZERO,N=n.mul(B,B),Y=n.mul(L,L),z=n.mul(K,K),q=n.mul(B,L);return q=n.add(q,q),R=n.mul(B,K),R=n.add(R,R),U=n.mul(p,R),_=n.mul(h,z),_=n.add(U,_),U=n.sub(Y,_),_=n.add(Y,_),_=n.mul(U,_),U=n.mul(q,U),R=n.mul(h,R),z=n.mul(p,z),q=n.sub(N,z),q=n.mul(p,q),q=n.add(q,R),R=n.add(N,N),N=n.add(R,N),N=n.add(N,z),N=n.mul(N,q),_=n.add(_,N),z=n.mul(L,K),z=n.add(z,z),N=n.mul(z,q),U=n.sub(U,N),R=n.mul(z,Y),R=n.add(R,R),R=n.add(R,R),new g(U,_,R)}add(p){I(p);let{X:m,Y:h,Z:B}=this,{X:L,Y:K,Z:U}=p,_=n.ZERO,R=n.ZERO,N=n.ZERO,Y=s.a,z=n.mul(s.b,Vr),q=n.mul(m,L),$=n.mul(h,K),rt=n.mul(B,U),Bt=n.add(m,h),X=n.add(L,K);Bt=n.mul(Bt,X),X=n.add(q,$),Bt=n.sub(Bt,X),X=n.add(m,B);let ot=n.add(L,U);return X=n.mul(X,ot),ot=n.add(q,rt),X=n.sub(X,ot),ot=n.add(h,B),_=n.add(K,U),ot=n.mul(ot,_),_=n.add($,rt),ot=n.sub(ot,_),N=n.mul(Y,X),_=n.mul(z,rt),N=n.add(_,N),_=n.sub($,N),N=n.add($,N),R=n.mul(_,N),$=n.add(q,q),$=n.add($,q),rt=n.mul(Y,rt),X=n.mul(z,X),$=n.add($,rt),rt=n.sub(q,rt),rt=n.mul(Y,rt),X=n.add(X,rt),q=n.mul($,X),R=n.add(R,q),q=n.mul(ot,X),_=n.mul(Bt,_),_=n.sub(_,q),q=n.mul(Bt,$),N=n.mul(ot,N),N=n.add(N,q),new g(_,R,N)}subtract(p){return this.add(p.negate())}is0(){return this.equals(g.ZERO)}multiply(p){let{endo:m}=t;if(!o.isValidNot0(p))throw new Error("invalid scalar: out of range");let h,B,L=K=>M.cached(this,K,U=>ce(g,U));if(m){let{k1neg:K,k1:U,k2neg:_,k2:R}=T(p),{p:N,f:Y}=L(U),{p:z,f:q}=L(R);B=Y.add(q),h=w(m.beta,N,z,K,_)}else{let{p:K,f:U}=L(p);h=K,B=U}return ce(g,[h,B])[0]}multiplyUnsafe(p){let{endo:m}=t,h=this;if(!o.isValid(p))throw new Error("invalid scalar: out of range");if(p===Ot||h.is0())return g.ZERO;if(p===Ne)return h;if(M.hasCache(this))return this.multiply(p);if(m){let{k1neg:B,k1:L,k2neg:K,k2:U}=T(p),{p1:_,p2:R}=js(g,h,L,U);return w(m.beta,_,R,B,K)}else return M.unsafe(h,p)}toAffine(p){return O(this,p)}isTorsionFree(){let{isTorsionFree:p}=t;return i===Ne?!0:p?p(g,this):M.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:p}=t;return i===Ne?this:p?p(g,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(p=!0){return kt(p,"isCompressed"),this.assertValidity(),E(g,this,p)}toHex(p=!0){return Tt(this.toBytes(p))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let C=o.BITS,M=new _e(g,t.endo?Math.ceil(C/2):C);return g.BASE.precompute(8),g}function Di(e){return Uint8Array.of(e?2:3)}function Ui(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function yf(e,t={}){let{Fn:r}=e,n=t.randomBytes||Mt,o=Object.assign(Ui(e.Fp,r),{seed:Hn(r.ORDER)});function s(E){try{let d=r.fromBytes(E);return r.isValidNot0(d)}catch{return!1}}function i(E,d){let{publicKey:v,publicKeyUncompressed:A}=o;try{let y=E.length;return d===!0&&y!==v||d===!1&&y!==A?!1:!!e.fromBytes(E)}catch{return!1}}function c(E=n(o.seed)){return Mn(k(E,o.seed,"seed"),r.ORDER)}function a(E,d=!0){return e.BASE.multiply(r.fromBytes(E)).toBytes(d)}function f(E){let{secretKey:d,publicKey:v,publicKeyUncompressed:A}=o;if(!ee(E)||"_lengths"in r&&r._lengths||d===v)return;let y=k(E,void 0,"key").length;return y===v||y===A}function l(E,d,v=!0){if(f(E)===!0)throw new Error("first arg must be private key");if(f(d)===!1)throw new Error("second arg must be public key");let A=r.fromBytes(E);return e.fromBytes(d).multiply(A).toBytes(v)}let u={isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:c},x=Kr(c,a);return Object.freeze({getPublicKey:a,getSharedSecret:l,keygen:x,Point:e,utils:u,lengths:o})}function Ri(e,t,r={}){Ee(t),zt(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),r=Object.assign({},r);let n=r.randomBytes||Mt,o=r.hmac||((m,h)=>cr(t,m,h)),{Fp:s,Fn:i}=e,{ORDER:c,BITS:a}=i,{keygen:f,getPublicKey:l,getSharedSecret:u,utils:x,lengths:E}=yf(e,r),d={prehash:!0,lowS:typeof r.lowS=="boolean"?r.lowS:!0,format:"compact",extraEntropy:!1},v=c*_i<s.ORDER;function A(m){let h=c>>Ne;return m>h}function y(m,h){if(!i.isValidNot0(h))throw new Error(`invalid signature ${m}: out of range 1..Point.Fn.ORDER`);return h}function S(){if(v)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function b(m,h){xo(h);let B=E.signature,L=h==="compact"?B:h==="recovered"?B+1:void 0;return k(m,L)}class I{r;s;recovery;constructor(h,B,L){if(this.r=y("r",h),this.s=y("s",B),L!=null){if(S(),![0,1,2,3].includes(L))throw new Error("invalid recovery id");this.recovery=L}Object.freeze(this)}static fromBytes(h,B=d.format){b(h,B);let L;if(B==="der"){let{r:R,s:N}=Xt.toSig(k(h));return new I(R,N)}B==="recovered"&&(L=h[0],B="compact",h=h.subarray(1));let K=E.signature/2,U=h.subarray(0,K),_=h.subarray(K,K*2);return new I(i.fromBytes(U),i.fromBytes(_),L)}static fromHex(h,B){return this.fromBytes(Ct(h),B)}assertRecovery(){let{recovery:h}=this;if(h==null)throw new Error("invalid recovery id: must be present");return h}addRecoveryBit(h){return new I(this.r,this.s,h)}recoverPublicKey(h){let{r:B,s:L}=this,K=this.assertRecovery(),U=K===2||K===3?B+c:B;if(!s.isValid(U))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let _=s.toBytes(U),R=e.fromBytes(pt(Di((K&1)===0),_)),N=i.inv(U),Y=O(k(h,void 0,"msgHash")),z=i.create(-Y*N),q=i.create(L*N),$=e.BASE.multiplyUnsafe(z).add(R.multiplyUnsafe(q));if($.is0())throw new Error("invalid recovery: point at infinify");return $.assertValidity(),$}hasHighS(){return A(this.s)}toBytes(h=d.format){if(xo(h),h==="der")return Ct(Xt.hexFromSig(this));let{r:B,s:L}=this,K=i.toBytes(B),U=i.toBytes(L);return h==="recovered"?(S(),pt(Uint8Array.of(this.assertRecovery()),K,U)):pt(K,U)}toHex(h){return Tt(this.toBytes(h))}}let T=r.bits2int||function(h){if(h.length>8192)throw new Error("input is too large");let B=Be(h),L=h.length*8-a;return L>0?B>>BigInt(L):B},O=r.bits2int_modN||function(h){return i.create(T(h))},H=Je(a);function w(m){return We("num < 2^"+a,m,Ot,H),i.toBytes(m)}function g(m,h){return k(m,void 0,"message"),h?k(t(m),void 0,"prehashed message"):m}function C(m,h,B){let{lowS:L,prehash:K,extraEntropy:U}=bo(B,d);m=g(m,K);let _=O(m),R=i.fromBytes(h);if(!i.isValidNot0(R))throw new Error("invalid private key");let N=[w(R),w(_)];if(U!=null&&U!==!1){let $=U===!0?n(E.secretKey):U;N.push(k($,void 0,"extraEntropy"))}let Y=pt(...N),z=_;function q($){let rt=T($);if(!i.isValidNot0(rt))return;let Bt=i.inv(rt),X=e.BASE.multiply(rt).toAffine(),ot=i.create(X.x);if(ot===Ot)return;let hr=i.create(Bt*i.create(z+ot*R));if(hr===Ot)return;let Lo=(X.x===ot?0:2)|Number(X.y&Ne),_o=hr;return L&&A(hr)&&(_o=i.neg(hr),Lo^=1),new I(ot,_o,v?void 0:Lo)}return{seed:Y,k2sig:q}}function M(m,h,B={}){let{seed:L,k2sig:K}=C(m,h,B);return Ks(t.outputLen,i.BYTES,o)(L,K).toBytes(B.format)}function D(m,h,B,L={}){let{lowS:K,prehash:U,format:_}=bo(L,d);if(B=k(B,void 0,"publicKey"),h=g(h,U),!ee(m)){let R=m instanceof I?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+R)}b(m,_);try{let R=I.fromBytes(m,_),N=e.fromBytes(B);if(K&&R.hasHighS())return!1;let{r:Y,s:z}=R,q=O(h),$=i.inv(z),rt=i.create(q*$),Bt=i.create(Y*$),X=e.BASE.multiplyUnsafe(rt).add(N.multiplyUnsafe(Bt));return X.is0()?!1:i.create(X.x)===Y}catch{return!1}}function p(m,h,B={}){let{prehash:L}=bo(B,d);return h=g(h,L),I.fromBytes(m,"recovered").recoverPublicKey(h).toBytes()}return Object.freeze({keygen:f,getPublicKey:l,getSharedSecret:u,utils:x,lengths:E,Point:e,sign:M,verify:D,recoverPublicKey:p,Signature:I,hash:t})}var Eo={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},bf={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var Ti=BigInt(2);function xf(e){let t=Eo.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),f=e*e*e%t,l=f*f*e%t,u=j(l,r,t)*l%t,x=j(u,r,t)*l%t,E=j(x,Ti,t)*f%t,d=j(E,o,t)*E%t,v=j(d,s,t)*d%t,A=j(v,c,t)*v%t,y=j(A,a,t)*A%t,S=j(y,c,t)*v%t,b=j(S,r,t)*l%t,I=j(b,i,t)*d%t,T=j(I,n,t)*f%t,O=j(T,Ti,t);if(!wo.eql(wo.sqr(O),e))throw new Error("Cannot find square root");return O}var wo=Ie(Eo.p,{sqrt:xf}),gf=Ki(Eo,{Fp:wo,endo:bf}),St=Ri(gf,Ft);var Ci=33,Ni=32;function ki(e,t,r){let n=br.digest(t instanceof Uint8Array?t:t.subarray());if(Ue(n))return n.then(({digest:o})=>(r?.signal?.throwIfAborted(),St.sign(o,e,{prehash:!1,format:"der"}))).catch(o=>{throw o.name==="AbortError"?o:new ke(String(o))});try{return St.sign(n.digest,e,{prehash:!1,format:"der"})}catch(o){throw new ke(String(o))}}function Oi(e,t,r,n){let o=br.digest(r instanceof Uint8Array?r:r.subarray());if(Ue(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),St.verify(t,s,e,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new Oe(String(s))});try{return n?.signal?.throwIfAborted(),St.verify(t,o.digest,e,{prehash:!1,format:"der"})}catch(s){throw new Oe(String(s))}}var fr=class{type="secp256k1";raw;_key;constructor(t){this._key=Mi(t),this.raw=Pi(this._key)}toMultihash(){return Jt.digest(te(this))}toCID(){return gt.createV1(114,this.toMultihash())}toString(){return Q.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}verify(t,r,n){return Oi(this._key,r,t,n)}},ur=class{type="secp256k1";raw;publicKey;constructor(t,r){this.raw=Hi(t),this.publicKey=new fr(r??qi(t))}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:it(this.raw,t.raw)}sign(t,r){return ki(this.raw,t,r)}};function Ao(e){return new ur(e)}function Zr(e){return new fr(e)}async function Vi(){let e=wf();return new ur(e)}function Pi(e){return St.Point.fromBytes(e).toBytes()}function Hi(e){try{return St.getPublicKey(e,!0),e}catch(t){throw new Pe(String(t))}}function Mi(e){try{return St.Point.fromBytes(e),e}catch(t){throw new he(String(t))}}function qi(e){try{return St.getPublicKey(e,!0)}catch(t){throw new Pe(String(t))}}function wf(){return St.utils.randomSecretKey()}var Fr={"P-256":32,"P-384":48,"P-521":66},Ef=Object.keys(Fr),So=Ef.join(" / ");async function Zi(e){if(e!=="P-256"&&e!=="P-384"&&e!=="P-521")throw new P(`Unknown curve: ${e}. Must be ${So}`);let t=await G.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]),r=async(s,i)=>{let c;i!=null?c=await G.get().subtle.importKey("jwk",Sf(e,i),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):c=t.privateKey;let a=await G.get().subtle.importKey("jwk",Fi(e,s),{name:"ECDH",namedCurve:e},!1,[]),f=await G.get().subtle.deriveBits({name:"ECDH",public:a},c,Fr[e]*8);return new Uint8Array(f,0,f.byteLength)},n=await G.get().subtle.exportKey("jwk",t.publicKey);return{key:Af(n),genSharedKey:r}}function Af(e){if(e.crv==null||e.x==null||e.y==null)throw new P("JWK was missing components");if(e.crv!=="P-256"&&e.crv!=="P-384"&&e.crv!=="P-521")throw new P(`Unknown curve: ${e.crv}. Must be ${So}`);let t=Fr[e.crv];return It([Uint8Array.from([4]),jn(e.x,t),jn(e.y,t)],1+t*2)}function Fi(e,t){if(e!=="P-256"&&e!=="P-384"&&e!=="P-521")throw new P(`Unknown curve: ${e}. Must be ${So}`);let r=Fr[e];if(!it(t.subarray(0,1),Uint8Array.from([4])))throw new P("Cannot unmarshal public key - invalid key format");return{kty:"EC",crv:e,x:V(t.subarray(1,r+1),"base64url"),y:V(t.subarray(1+r),"base64url"),ext:!0}}var Sf=(e,t)=>({...Fi(e,t.public),d:V(t.private,"base64url")});var Bf={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,keySize:32}};async function zi(e,t,r){if(e!=="AES-128"&&e!=="AES-256"&&e!=="Blowfish")throw new P("Cipher type was missing or unsupported");if(t!=="SHA1"&&t!=="SHA256"&&t!=="SHA512")throw new P("Hash type was missing or unsupported");if(r==null||!(r instanceof Uint8Array))throw new P("Secret was missing or an incorrect type");let n=Bf[e],o=n.keySize,s=n.ivSize,i=20,c=F("key expansion"),a=2*(s+o+i),f=await jr(t,r),l=await f.digest(c),u=[],x=0;for(;x<a;){let S=await f.digest(It([l,c])),b=S.length;x+b>a&&(b=a-x),u.push(S),x+=b,l=await f.digest(l)}let E=a/2,d=It(u),v=d.subarray(0,E),A=d.subarray(E,a),y=S=>({iv:S.subarray(0,s),cipherKey:S.subarray(s,s+o),macKey:S.subarray(s+o)});return{k1:y(v),k2:y(A)}}async function vf(e,t){if(e==="Ed25519")return oi();if(e==="secp256k1")return Vi();if(e==="RSA")return yo(Tf(t));if(e==="ECDSA")return ds(Cf(t));throw new Pt}async function If(e,t){if(e!=="Ed25519")throw new Pt("Seed key derivation only supported for Ed25519 keys");return si(t)}function Lf(e,t){let{Type:r,Data:n}=_t.decode(e),o=n??new Uint8Array;switch(r){case Z.RSA:return mo(o,t);case Z.Ed25519:return Ur(o);case Z.secp256k1:return Zr(o);case Z.ECDSA:return An(o);default:throw new Pt}}function _f(e){if(e.byteLength===Gt)return Ur(e);if(e.byteLength===Ci)return Zr(e);let t=yt(e),r=t[1]?.[0];if(r===xn||r===gn||r===wn)return Sn(t);if(t[0]?.[0]===Ii)return Hr(t,e);throw new P("Could not extract public key from raw bytes")}function Kf(e){let{Type:t,Data:r}=_t.decode(e.digest),n=r??new Uint8Array;switch(t){case Z.Ed25519:return Ur(n);case Z.secp256k1:return Zr(n);case Z.ECDSA:return An(n);default:throw new Pt}}function te(e){return _t.encode({Type:Z[e.type],Data:e.raw})}function Df(e){let t=sr.decode(e),r=t.Data??new Uint8Array;switch(t.Type){case Z.RSA:return po(r);case Z.Ed25519:return Gn(r);case Z.secp256k1:return Ao(r);case Z.ECDSA:return fs(r);default:throw new Pt}}function Uf(e){if(e.byteLength===bt)return Gn(e);if(e.byteLength===Ni)return Ao(e);let t=yt(e),r=t[2]?.[0];if(r===xn||r===gn||r===wn)return En(t);if(t.length>8)return Pr(t);throw new P("Could not extract private key from raw bytes")}function Rf(e){return sr.encode({Type:Z[e.type],Data:e.raw})}function Tf(e){return e==null?2048:parseInt(e,10)}function Cf(e){if(e==="P-256"||e==null)return"P-256";if(e==="P-384")return"P-384";if(e==="P-521")return"P-521";throw new P("Unsupported curve, should be P-256, P-384 or P-521")}async function Nf(e){if(e.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",e.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",e.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(e.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",e.jwk,{name:"ECDSA",namedCurve:e.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",e.publicKey.jwk,{name:"ECDSA",namedCurve:e.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new P("Only RSA and ECDSA keys are supported")}async function kf(e){if(e.privateKey.algorithm.name==="RSASSA-PKCS1-v1_5"){let t=await crypto.subtle.exportKey("jwk",e.privateKey);return Mr(t)}if(e.privateKey.algorithm.name==="ECDSA"){let t=await crypto.subtle.exportKey("jwk",e.privateKey);return new Ut(t)}throw new P("Only RSA and ECDSA keys are supported")}var lr=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),Wt=new Uint32Array(80),vo=class extends re{A=lr[0]|0;B=lr[1]|0;C=lr[2]|0;D=lr[3]|0;E=lr[4]|0;constructor(){super(64,20,8,!1)}get(){let{A:t,B:r,C:n,D:o,E:s}=this;return[t,r,n,o,s]}set(t,r,n,o,s){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0}process(t,r){for(let a=0;a<16;a++,r+=4)Wt[a]=t.getUint32(r,!1);for(let a=16;a<80;a++)Wt[a]=wr(Wt[a-3]^Wt[a-8]^Wt[a-14]^Wt[a-16],1);let{A:n,B:o,C:s,D:i,E:c}=this;for(let a=0;a<80;a++){let f,l;a<20?(f=Er(o,s,i),l=1518500249):a<40?(f=o^s^i,l=1859775393):a<60?(f=Ar(o,s,i),l=2400959708):(f=o^s^i,l=3395469782);let u=wr(n,5)+f+c+l+Wt[a]|0;c=i,i=s,s=wr(o,30),o=n,n=u}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,this.set(n,o,s,i,c)}roundClean(){dt(Wt)}destroy(){this.set(0,0,0,0,0),dt(this.buffer)}},ji=Ge(()=>new vo);function Of(e,t,r,n){Ee(e);let o=bs({dkLen:32,asyncTick:10},n),{c:s,dkLen:i,asyncTick:c}=o;if(ht(s,"c"),ht(i,"dkLen"),ht(c,"asyncTick"),s<1)throw new Error("iterations (c) must be >= 1");let a=Bn(t,"password"),f=Bn(r,"salt"),l=new Uint8Array(i),u=cr.create(e,a),x=u._cloneInto().update(f);return{c:s,dkLen:i,asyncTick:c,DK:l,PRF:u,PRFSalt:x}}function Pf(e,t,r,n,o){return e.destroy(),t.destroy(),n&&n.destroy(),dt(o),r}function Gi(e,t,r,n){let{c:o,dkLen:s,DK:i,PRF:c,PRFSalt:a}=Of(e,t,r,n),f,l=new Uint8Array(4),u=Se(l),x=new Uint8Array(c.outputLen);for(let E=1,d=0;d<s;E++,d+=c.outputLen){let v=i.subarray(d,d+c.outputLen);u.setInt32(0,E,!1),(f=a._cloneInto(f)).update(l).digestInto(x),v.set(x.subarray(0,v.length));for(let A=1;A<o;A++){c._cloneInto(f).update(x).digestInto(x);for(let y=0;y<v.length;y++)v[y]^=x[y]}}return Pf(c,a,i,f,x)}var Yi={sha1:ji,"sha2-256":Ft,"sha2-512":Br};function Io(e,t,r,n,o){if(o!=="sha1"&&o!=="sha2-256"&&o!=="sha2-512"){let c=Object.keys(Yi).join(" / ");throw new P(`Hash '${o}' is unknown or not supported. Must be ${c}`)}let s=Yi[o],i=Gi(s,e,t,{c:r,dkLen:n});return cn.encode(i).substring(1)}return Qi(Hf);})();
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/edwards.js:
@noble/curves/ed25519.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PCrypto}));
//# sourceMappingURL=index.min.js.map
